{% extends "metagame/base.html" %}

{% block extrahead %}
    <title>Profiel van {{ player.user.username }} &bull; PLAY Pilots</title>
    
    <style type="text/css" media="screen">
        html {
/*            background: transparent url({{ MEDIA_URL }}image/grid.png) repeat-y center top ;*/
        }
        #contentwrapper {
            background-color: #f5f5f5;
            background-image: url({{ MEDIA_URL }}image/grain_overlay.png);
        }
        
        #player {
            overflow: auto;
        }
    
        #actions {
            border-left: thin solid #ddd;
            border-right: thin solid #ddd;
            
            width: 578px; /* 620px; */
            padding: 20px;
            
            float: right;
        }
        
        #profile {
            margin-top: 20px;
            
            width: 300px;
            float: left;
        }
        
        #profile H4 {
            border-bottom: thin solid #ddd;
            margin-bottom: 10px;
        }
        
        #details {
            background-color: #b7d1d0;
            
            padding: 30px 20px 20px 20px;
            
            color: #fff;
            border-bottom: 5px solid #ddd;
        }
        
        .you #details {
            background-color: #f30;
/*            color: #fff;*/
        }
        
        #details img#profile_badge_tag {
            position: relative;
            top: -50px;
            left: 50px;
        }
        
        #details img.buddy-icon {
            width: 40px;
            height: 40px;
            float: left;
        }
        
        #details H2 {
            color: white;
            text-shadow: black 0px 1px 0px;
            margin: -50px 0 0 50px;
        }
        
        #details p.rank {
            font-size: 12px;
            margin: 0 0 0 50px;
            color: #333;
        }
        
        .you #details p.rank {
            color: #fff;
        }
        
        #details p.rank span, #levels td.rank span {
            color: white;
            background: transparent url({{ MEDIA_URL }}image/ranking_bar_bg.png) no-repeat center center;
            -webkit-border-radius: 2px;
            -moz-border-radius: 2px;
            font-size: 10px;
            padding: 0 2px;
            display: inline-block;
            line-height: 21px;
            margin: 0 2px 0 0;        
            
        }
        
        #details form {
            text-align: right;
            margin-bottom: 0;
        }
        
        #details button {
            margin-bottom: 0;
        }
        
        #record table, #levels table {
            color: #666;
            width: 260px;
            font-size: 12px;
            font-weight: bold;
        }
        
        #record tr.even, #levels tr.even {
            background-color: #f5f5f5;
        }
        
        #record td, #levels td {
            line-height: 31.5px;
            padding: 0 2px;
        }
        
        #record td {
            width: 50%;
        }
        
        #levels td {
            width: 25%;
        }
        
        #levels td.style {
            width: 50%;
        }
        
        #levels h4 {
        }
        
        #levels td img {
            display: inline;
            vertical-align: text-bottom;
        }
        
        #record, #levels, #festivals {
            padding: 10px 20px;
            margin-bottom: 20px ;
            
            background-color: white;
        }
        
        #festivals p a {
            font-weight: bold;
            text-decoration: none;
            color: #f30;
            font-size: 12px;
        }
        
        #festivals p a:hover {
            text-decoration: underline;
        }
        
        /* TODO schaduw onderaan linker kolom */
        
        #actions h3 img {
            margin-top: -1px;
            margin-left: -2px;
            margin-bottom: 20px;            
        }
        
        #incoming, #outgoing {            
            border: thin solid #ddd;
            
            background-color: white;
            
            margin-bottom: 20px;
        }
        
        #incoming A, #outgoing A, #history A {
            color: #f30;
            text-decoration: none;
        }
        
        #incoming A:hover, #outgoing A:hover, #history A:hover {
            text-decoration: underline;
        }
        
        #incoming H4, #outgoing H4 {
            color: #bbb;
            margin: -10.5px 0 10.5px 18px;
            background-color: #fff;
            padding: 0 2px;
            float: left;
        }
        
        #incoming OL, #outgoing OL {
            clear: left;
            margin: 0 20px 10px 20px;
        }
        
        #incoming LI, #outgoing LI, #history LI {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        #incoming LI.notlast, #outgoing LI.notlast, #history LI.notlast {
            border-bottom: thin solid #ddd;
            padding-bottom: 9px;
            padding-bottom: 10px;            
        }
        
        li span.style, li span.username {
            text-transform: uppercase;
        }
        
        li span.message {
            font-weight: normal;
        }
        
        li span.timestamp {
            font-weight: normal;
            font-size: 12px;
            color: #666;
            display: block;
        }
        
        .duel form {
            display: block;
            overflow: auto;
            width: 100%;
            margin: -21px 0 0 0;
        }
        
        .duel BUTTON.door {
            float: right;
            margin: 0;
        }
        
        .duel .style {
            text-transform: capitalize;
        }
        
        .duel .view {
            text-align: right;
            margin: -21px 0 0 0;
            font-weight: normal;
        }
        
        #history ol {
            margin: 0;
        }
        
        #history li {
        }
    </style>
    
    
{% endblock %}

{% block content %}
<div id="player" class="mainblock{% ifequal player.user user %} you{% endifequal%}">
    <div id="profile">
        
        <div id="details">
            <img id="profile_badge_tag" src="{{ MEDIA_URL }}image/profile_badge_tag.png" alt="">
            <img class="buddy-icon" src="{% spaceless %}
            {% if user.get_profile.get_avatar_url %}
                {{ user.get_profile.get_avatar_url }}
            {% endif %}
                {{ MEDIA_URL }}image/buddy-icon-login-box.png
            {% endif %}
            {% endspaceless %}" alt="">
            
            <h2>{{ player.user.username }}</h2>
            
            <p class="rank"><span>{{ player.get_rank|stringformat:".3d" }}</span> in het algemeen klassement</p>
            
            {% ifnotequal player.user user %}
                <form method="GET" action="/challenge/">
                    <input type="hidden" name="target" value="{{ player.id }}">
                    
                    <button class="door"><p class="door">Daag {{ player.user.first_name }} nu uit</p></button>
                </form>
                {% else %}
                <!-- <p>Dit is jouw profiel.</p> -->
            {% endifnotequal %}
        </div>
        
        <div id="record">
            <table>
                <tr class="odd">
                    <td>Gewonnen</td>
                    <td>{{ player.get_win_count }}</td>
                </tr>
                
                <tr class="even">
                    <td>Verloren</td>
                    <td>{{ player.get_loss_count }}</td>
                </tr>
                
                <tr class="odd">
                    <td>Gelijkspel</td>
                    <td>{{ player.get_tie_count }}</td>
                </tr>
            </table>
        </div>
        
        <div id="levels">
            <h4>Stijlen</h4>
            
            <table>
                {% for skill in skills %}
                    <tr class="{% cycle 'odd' 'even' %}">
                        <td class="style">{{ skill.style.name }}</td>
                        <td><img src="{{ MEDIA_URL }}image/level_{{ skill.level }}.png"></td>
                        
                        <!--
                            TODO think of a decent way to calculate rank per style
                        --> 
                        <td class="rank"><span>{{ skill.experience|stringformat:".3d" }}</span></td>
                    </tr>
                {% endfor %}             
            </table>
        </div>
        
        <div id="festivals">
            <h4>Festivals</h4>            
            {% for game in player.game_set.all %}
                <p><a href="/games/{{ game.slug }}">{{ game.festival }}</a> &raquo;</p>
            {% endfor %}
        </div>
    </div>
    
    <div id="actions">
        
        <h3><img src="{{ MEDIA_URL }}image/tag_lopende_duels.png" alt="lopende duels"></h3>
        
        <div id="incoming">
            <h4>Ontvangen</h4>
            
            <ol id="incoming_duels">
                {% for duel in player.get_responder_duels %}
                    <li id="duel_{{ duel.id }}" class="duel {% if not forloop.last %}notlast{% endif %}">
                        <span class="style">{{ duel.challenge_move.style.name }}</span>
                        <span class="username"><a href="/players/{{ duel.challenger.id }}/">{{ duel.challenger }}</a></span>
                        <span class="move">{{ duel.get_challenge_move }}</span>
                        
                        {% if duel.challenge_message %}
                            en zegt: <span class="message">&ldquo;{{ duel.challenge_message }}&rdquo;</span>
                        {% endif %}

                        <span class="timestamp">{{ duel.created|timesince }} geleden</span>
                        
                        {% ifequal user.get_profile duel.target %}
                            <form method="GET" action="/c/{{ duel.id }}/">
                                <button class="door"><p class="door">beantwoord</p></button>
                            </form>
                        {% endifequal %}
                    </li>
                    {% empty %}
                    <li>Niks, nada, noppes. Ze durven niet!</li>
                {% endfor %}                
            </ol>
        </div>
        
        <div id="outgoing">
            <h4>Verzonden</h4>
            
            <ol id="outgoing_duels">
                {% for duel in player.get_challenger_duels %}
                    <li id="duel_{{ duel.id }}" class="duel {% if not forloop.last %}notlast{% endif %}"><span class="style">{{ duel.challenge_move.style.name }}</span>
                        <span class="username">{{ player.user.first_name }}</span>
                        <span class="move">{{ duel.get_challenge_move }}</span>
                        
                        {% if duel.challenge_message %}
                            en zegt: <span class="message">&ldquo;{{ duel.challenge_message }}&rdquo;</span>
                        {% endif %}
                        
                        <span class="timestamp">{{ duel.created|timesince }} geleden</span>
                        <p class="view"><a href="/c/{{ duel.id }}/">Bekijk duel</a> &raquo;</p>
                    </li>
                    {% empty %}
                    <li>Nog niemand uitgedaagd. Een beetje bang misschien? Ga naar het <a href="/klassement/">klassement</a>.</li>
                {% endfor %}
            </ol>
        </div>
        
        <div id="history">
            <h4>Historie</h4>
            
            <ol>
                {% for duel in player.get_finished_duels %}
                    <li class="notlast duel"><span class="style">{{ duel.get_winner_style }}</span> <span class="username">{{ duel.get_winner }}</span>
                        {% if duel.get_win_phrase %}
                            {{ duel.get_win_phrase }}
                        {% endif %}
                        <span class="timestamp">{{ duel.responded|timesince }} geleden</span> <p class="view"><a href="/c/{{ duel.id }}/">Bekijk duel</a> &raquo;</p></li>  
                {% endfor %}
            </ol>
        </div>

    </div>
{% endblock %}
