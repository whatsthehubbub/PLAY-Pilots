{% extends "metagame/base.html" %}

{% block extrahead %}
    
    <script type="text/javascript" charset="utf-8">
        
        var moves = {};
        {% for style in styles %}
            moves['{{ style.name }}'] = [];

            {% for move in style.move_set.all %}
                moves['{{ style.name }}'].push([{{ move.id }}, '{{ move.name }}']);
            {% endfor %}
        {% endfor %}
        
        function fillMoves() {
            var culture = $('#style option:selected').text();
            
            var html = '';
            
            for (var counter in moves[culture]) {
                var move = moves[culture][counter];
                html += '<option value="' + move[0] + '">' + move[1] + '</option>';
            }
            
            $('#move').html(html);
        }
        
        $(document).ready(function() {
            fillMoves();
            
            $('#style').change(function() {
                fillMoves();
            });
            
            $('#challenge_form').ajaxForm({
                dataType: 'json',
                success: function(data) {
                    var awesomeness = data['awesomeness'];
                    
                    $('#challenge_button').replaceWith('<p>Je beweging heeft de coolness: ' + awesomeness + '</p>');
                }
            });
        });
    </script> 
{% endblock %}

{% block content %}
    <form method="POST" action="/challenge/" id="challenge_form">
    
    <p>Challenger: 
    
    {{ user.username }} - {{ user.get_profile }}
    
    <p>Kies <label for="style">je cultuur</label>:
        <select id="style" name="style">
            {% for style in styles %}
                <option value="{{ style.id }}">{{ style.name }}</option>
            {% endfor %}
        </select>
        en <label for="move">je beweging</label>:
        <select id="move" name="move">
            
        </select>
        
        <br>Laat nog <label for="message">een boodschap</label> achter voor je tegenstander: <input name="message" id="message">
    </p>
    
    <p>Target: 
    
    <input type="hidden" name="target" value="{{ target.id }}">
    {{ target.user.username }} ({{ target.rating }}) - {{ target.culture }}
    
    
    <p><button type="submit" id="challenge_button">Daag uit!</button></p>
    
    </form>
    
{% endblock %}